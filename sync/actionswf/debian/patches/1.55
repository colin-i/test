Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 actionswf (1-55) bionic; urgency=medium
 .
   * readd i386
Author: bc <bc@bc-HP-Pavilion-x360-Convertible>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: 2022-11-10

--- actionswf-1.orig/Makefile
+++ actionswf-1/Makefile
@@ -1,14 +1,18 @@
 TOPTARGETS := all install clean distclean uninstall test
 
 #ifndef test
-#SUBDIRS := src
-#else
+
+ifeq ($(shell dpkg-architecture -qDEB_HOST_ARCH), amd64)
+conv_64=0
+else
+conv_64=1
+endif
+
 SUBDIRS := src example
-#endif
 
 $(TOPTARGETS): $(SUBDIRS)
 $(SUBDIRS):
-	$(MAKE) -C $@ $(MAKECMDGOALS)
+	$(MAKE) -C $@ conv_64=${conv_64} $(MAKECMDGOALS)
 .PHONY: $(TOPTARGETS) $(SUBDIRS)
 
 .NOTPARALLEL:
--- actionswf-1.orig/example/Makefile
+++ actionswf-1/example/Makefile
@@ -10,22 +10,23 @@ syms=-s
 conv_64=0
 OFLAGS=conv_64 ${conv_64}
 
+name=example
+linkname=actionswf
+linkfile=${linkname}.lib
+
 ifeq (${platform},win)
 	OFLAGS += inplace_reloc 0 include_sec 1
 else
+	stripname=lib${linkname}.so
 	ifeq (${conv_64},1)
 		OFLAGS += exit_end 1
 		# underscore_pref 1   win32 with _, can go back to this later
 	endif
 endif
 
-name=example
-linkname=actionswf
-linkfile=${linkname}.lib
-
 all: build exe
 
-build: ${name} uns lib lnk
+build: ${name} uns lib link
 
 uns:
 	${OLINK} ${name}.s.log
@@ -39,12 +40,12 @@ lib:
 		fi \
 	fi
 
-lnk:
+link:
 	if [ "${platform}" = "lin" ]; then \
 		if [ "${conv_64}" = "1" ]; then \
-			$(LD) ${syms} -melf_i386 --dynamic-linker=/lib/ld-linux.so.2 ${name}.o -entry main -o ${name} -lc -L../src -l:actionswf.so; \
+			$(LD) ${syms} -melf_i386 --dynamic-linker=/lib/ld-linux.so.2 ${name}.o -entry main -o ${name} -lc -L../src -l:${stripname}; \
 		else \
-			$(CC) ${syms} ${name}.o -o ${name} -L../src -l:actionswf.so; \
+			$(CC) ${syms} ${name}.o -o ${name} -L../src -l:${stripname}; \
 		fi \
 	else \
 		if [ "${conv_64}" = "1" ]; then \
--- actionswf-1.orig/src/Makefile
+++ actionswf-1/src/Makefile
@@ -5,9 +5,12 @@ ifndef OCOMP
 OCOMP=o
 endif
 
+ifndef conv_64
+conv_64=0
+endif
+
 OLINK=ounused
 syms=-s
-conv_64=0
 #OFLAGSEXTRA=
 #if modifying OFLAGS will lose inside data
 OFLAGS=conv_64 ${conv_64} ${OFLAGSEXTRA}
@@ -19,21 +22,14 @@ expitems = action swf tool ../shared/act
 
 exte=libexte.a
 
-ifeq (${platform},win)
-	OFLAGS += inplace_reloc 0 include_sec 1
-else
-	OFLAGS += underscore_pref 1
-endif
-
 debug=
-debugstrip=
+restofname=lib
 projname=actionswf${debug}
 name = ${projname}.so
-xname = lib${name}
 defname = ${projname}.def
 items_prefix=
 prefname=${items_prefix}${name}
-stripname=${debugstrip}${name}
+stripname=${restofname}${name}
 
 $(eval obs = )
 $(eval eobs = )
@@ -43,21 +39,21 @@ $(eval logs = )
 $(foreach var,$(expitems),$(eval logs += ${items_prefix}${var}.es.log))
 $(foreach var,$(items),$(eval logs += ${items_prefix}${var}.s.log))
 
-ATLDCOM = $(CC) ${syms} ${eobs} -shared -e DllMain -o ${name} -lc -L. -l:${exte} -Wl,--exclude-libs ${exte}
-
 strippy=ostriputil
 
 ifeq (${platform},win)
+OFLAGS += inplace_reloc 0 include_sec 1
 all: compile ounused link def
-else ifeq (${conv_64},1)
-all: compile ounused link
 else
+OFLAGS += underscore_pref 1
+#else ifeq (${conv_64},1)
+ifeq (${conv_64},1)
+ATLDCOM = $(LD) ${syms} -melf_i386 --dynamic-linker=/lib/ld-linux.so.2 ${eobs} -shared -entry DllMain -o ${prefname} -lc -L${items_prefix}. -l:${exte} --exclude-libs ${exte}
 all: compile ${name}
-${name}:
-	${OLINK} ${logs}
-	@echo
-	$(AR) cr ${exte} ${obs}
-	${ATLDCOM}
+else
+ATLDCOM = $(CC) ${syms} ${eobs} -shared -e DllMain -o ${name} -lc -L. -l:${exte} -Wl,--exclude-libs ${exte}
+all: compile ${name} ${stripname}
+${stripname}:
 	$(eval strp = )
 	$(foreach var,$(expitems),$(eval strp += ${items_prefix}${var}.es.log ${items_prefix}${var}.o))
 	$(foreach var,$(items),$(eval strp += ${items_prefix}${var}.s.log ${items_prefix}${var}.o))
@@ -65,6 +61,13 @@ ${name}:
 	#if [ ! -e "./strip.py" ]; then wget https://raw.githubusercontent.com/colin-i/o/master/ostrip/strip.py; fi
 	${strippy} ${name} ${stripname}
 endif
+${name}:
+	${OLINK} ${logs}
+	@echo
+	$(AR) cr ${exte} ${obs}
+	${ATLDCOM}
+	if [ "${conv_64}" = "1" ]; then cp ${name} ${stripname}; fi
+endif
 
 %.o: %.s
 	${OCOMP} $< ${OFLAGS}
@@ -80,11 +83,7 @@ compile: ${obs} ${eobs}
 link:
 	if [ "${platform}" = "lin" ]; then \
 		$(AR) cr ${exte} ${obs}; \
-		if [ "${conv_64}" = "1" ]; then \
-			$(LD) ${syms} -melf_i386 --dynamic-linker=/lib/ld-linux.so.2 ${eobs} -shared -entry DllMain -o ${prefname} -lc -L${items_prefix}. -l:${exte} --exclude-libs ${exte}; \
-		else \
-			${ATLDCOM}; \
-		fi \
+		${ATLDCOM}; \
 	else \
 		if [ "${conv_64}" = "1" ]; then \
 			i686-w64-mingw32-ld --no-leading-underscore ${syms} ${eobs} ${obs} -shared -entry=DllMain -lmsvcrt -o ${projname}.dll --exclude-modules-for-implib `printf ',%s' ${obs} | cut -c2-`; \
@@ -120,13 +119,13 @@ test:
 	echo "Nothing"
 
 install-lib:
-	install -D ${name} \
-		$(DESTDIR)$(prefix)/lib/${xname}
+	install -D ${stripname} \
+		$(DESTDIR)$(prefix)/lib/${stripname}
 
 install: all install-lib
 
 uninstall:
-	-rm -f $(DESTDIR)$(prefix)/lib/${xname}
+	-rm -f $(DESTDIR)$(prefix)/lib/${stripname}
 
 .PHONY: all install clean distclean uninstall test
 
@@ -136,4 +135,4 @@ uninstall:
 #make syms= conv_64=0
 #make syms= conv_64=0 link
 
-#make debugstrip=lib strippy="python /home/bc/Desktop/ostriputil/ostriputil-1/ostriputil/main.py" OFLAGSEXTRA="function_name 1 nul_res_pref 1"
+#make strippy="python /home/bc/Desktop/ostriputil/ostriputil-1/ostriputil/main.py" OFLAGSEXTRA="function_name 1 nul_res_pref 1"
--- actionswf-1.orig/src/make64
+++ actionswf-1/src/make64
@@ -1,2 +1,2 @@
 
-make conv_64=0 $@
+make strippy="python /home/bc/Desktop/ostriputil/ostriputil-1/ostriputil/main.py" OFLAGSEXTRA="function_name 1 nul_res_pref 1" $@
